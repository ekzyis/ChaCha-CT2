<!--
    //<Auto-Generated>
    //This is here so CodeMaid doesn't reorganize this document.
    //</Auto-Generated>
-->
<UserControl x:Class="Cryptool.Plugins.ChaChaVisualizationV2.View.Diffusion"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:conv="clr-namespace:Cryptool.Plugins.ChaChaVisualizationV2.Helper.Converter"
                 xmlns:val="clr-namespace:Cryptool.Plugins.ChaChaVisualizationV2.Helper.Validation"
                 mc:Ignorable="d"
                 d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="..\Styles\Index.xaml" />
                <ResourceDictionary Source="..\ContentTemplate\PageContentTemplate.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <Style TargetType="TextBox" x:Key="DiffusionText" BasedOn="{StaticResource Text}">
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
            <Style TargetType="TextBox" x:Key="DiffusionHex" BasedOn="{StaticResource Hex}">
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
            <Style TargetType="TextBox" x:Key="DiffusionInput" BasedOn="{StaticResource DiffusionHex}">
                <Setter Property="IsReadOnly" Value="False"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Validation.ErrorTemplate">
                    <Setter.Value>
                        <ControlTemplate>
                            <StackPanel>
                                <AdornedElementPlaceholder x:Name="placeholder" />
                                <TextBlock FontSize="11" FontStyle="Italic" Foreground="Red"
                                               Text="{Binding ElementName=placeholder, Path=AdornedElement.(Validation.Errors)[0].ErrorContent}" />
                            </StackPanel>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <Style TargetType="{x:Type StackPanel}">
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="Margin" Value="5" />
            </Style>
            <conv:BytesToHex x:Key="ToHex" />
            <conv:BigIntegerToHexWithVersion x:Key="ToHexWithVersion" />
        </ResourceDictionary>
    </UserControl.Resources>
    <ContentControl Template="{StaticResource PageContentTemplate}" Name="Root">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="3*" />
                <RowDefinition Height="7*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="7*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <Viewbox Style="{StaticResource UniformViewbox}" Grid.Row="0" Grid.ColumnSpan="2">
                <RichTextBox Width="{Binding ElementName=Root, Path=ActualWidth}" Style="{StaticResource RichText}">
                    <FlowDocument>
                        <Paragraph>
                            On this page, you can enter another value for the Key, IV and initial counter.
                        </Paragraph>
                        <Paragraph>
                            The ChaCha cipher will also be executed with these input values. This is done to visualize the diffusion property of the cipher.
                            The values received from the diffusion execution will always be shown below the values received from the primary execution. The hex value which is different will be shown in red.  At the right side, there is an example how this will look like.
                        </Paragraph>
                        <Paragraph>
                            Additionally, during the ChaCha hash function, statistics about how many bits are flipped will be shown.
                            A well designed cipher should have 50% of all ciphertext bits flipped if any bit in the plaintext is flipped and vice versa.
                        </Paragraph>
                    </FlowDocument>
                </RichTextBox>
            </Viewbox>

            <!--#region Diffusion input -->

            <Viewbox Grid.Row="1" Grid.Column="0" Style="{StaticResource UniformViewbox}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" />
                        <ColumnDefinition Width="3*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Grid.Column="0">
                        <TextBox Text="Key (hex)" Style="{StaticResource DiffusionText}" />
                        <TextBox Text="Diffusion Key (hex)" Style="{StaticResource DiffusionText}"  />
                    </StackPanel>
                    <StackPanel Grid.Row="1" Grid.Column="0">
                        <TextBox Text="Initialization vector (hex)" Style="{StaticResource DiffusionText}" />
                        <TextBox Text="Diffusion Initialization vector (hex)" Style="{StaticResource DiffusionText}" />
                    </StackPanel>
                    <StackPanel Grid.Row="2" Grid.Column="0">
                        <TextBox Text="Initial counter (hex)" Style="{StaticResource DiffusionText}" />
                        <TextBox Text="Diffusion Initial counter (hex)" Style="{StaticResource DiffusionText}" />
                    </StackPanel>
                    <StackPanel Grid.Row="3" Grid.Column="0">
                        <TextBox Text="Flipped Bits" Style="{StaticResource DiffusionText}"/>
                        <TextBox Text="Diffusion state" Style="{StaticResource DiffusionText}"/>
                    </StackPanel>

                    <StackPanel Grid.Row="0" Grid.Column="1">
                        <TextBox Style="{StaticResource DiffusionHex}" Text="{Binding ChaCha.InputKey, Converter={StaticResource ToHex}, Mode=OneWay}" />
                        <TextBox Style="{StaticResource DiffusionInput}" Name="DiffusionInputKey"/>
                    </StackPanel>
                    <StackPanel Grid.Row="1" Grid.Column="1">
                        <TextBox Style="{StaticResource DiffusionHex}" Text="{Binding ChaCha.InputIV, Converter={StaticResource ToHex}, Mode=OneWay}"/>
                        <TextBox Style="{StaticResource DiffusionInput}" Name="DiffusionInputIV"/>
                    </StackPanel>
                    <StackPanel Grid.Row="2" Grid.Column="1">
                        <TextBox Style="{StaticResource DiffusionHex}">
                            <TextBox.Text>
                                <MultiBinding Converter="{StaticResource ToHexWithVersion}" Mode="OneWay">
                                    <Binding Path="ChaCha.InitialCounter" />
                                    <Binding Path="ChaCha.Settings" />
                                </MultiBinding>
                            </TextBox.Text>
                        </TextBox>
                        <TextBox Style="{StaticResource DiffusionInput}" Name="DiffusionInitialCounter"/>
                    </StackPanel>

                    <StackPanel Grid.Row="3" Grid.Column="1">
                        <TextBox Text="123/123 ( 100.00% )" Style="{StaticResource DiffusionText}"/>
                        <TextBox Text="Inactive" Style="{StaticResource DiffusionText}" Foreground="Red"/>
                    </StackPanel>

                </Grid>
            </Viewbox>
            <!--#endregion-->

            <Grid Grid.Row="1" Grid.Column="1" Name="Root2">
                <Viewbox Style="{StaticResource UniformViewbox}">
                    <RichTextBox Style="{StaticResource RichText}" Width="{Binding ElementName=Root2, Path=ActualWidth}">
                        <FlowDocument>
                            <Table>
                                <Table.Resources>
                                    <Style TargetType="TableCell">
                                        <Setter Property="BorderBrush" Value="Black" />
                                        <Setter Property="BorderThickness" Value="1" />
                                        <Setter Property="TextAlignment" Value="Center" />
                                    </Style>
                                    <Style TargetType="RichTextBox" BasedOn="{StaticResource RichHex}" />
                                </Table.Resources>
                                <Table.Columns>
                                    <TableColumn />
                                </Table.Columns>
                                <TableRowGroup>
                                    <TableRow>
                                        <TableCell BorderThickness="0">
                                            <Paragraph>
                                                <InlineUIContainer>
                                                    <Border Style="{StaticResource stateBorder}">
                                                        <StackPanel Orientation="Vertical">
                                                            <RichTextBox>
                                                                <FlowDocument>
                                                                    <Paragraph>
                                                                        F1AB5481
                                                                    </Paragraph>
                                                                </FlowDocument>
                                                            </RichTextBox>
                                                            <RichTextBox>
                                                                <FlowDocument>
                                                                    <Paragraph>
                                                                        F<Run Foreground="Red">3</Run>A<Run Foreground="Red">C1</Run>48<Run Foreground="Red">D</Run>
                                                                    </Paragraph>
                                                                </FlowDocument>
                                                            </RichTextBox>
                                                        </StackPanel>
                                                    </Border>
                                                </InlineUIContainer>
                                            </Paragraph>
                                        </TableCell>
                                    </TableRow>
                                </TableRowGroup>
                                <TableRowGroup>
                                    <TableRow>
                                        <TableCell BorderThickness="0">
                                            <Paragraph Style="{StaticResource Description}">Example how diffusion values are visualized. In the first row is the primary value, and in the second row is the diffusion value.</Paragraph>
                                        </TableCell>
                                    </TableRow>
                                </TableRowGroup>
                            </Table>
                        </FlowDocument>
                    </RichTextBox>
                </Viewbox>
            </Grid>
        </Grid>
    </ContentControl>
</UserControl>